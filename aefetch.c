#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <unistd.h>

#define BOLD "\033[1;93m"
#define RESET "\033[0m"
#define LOGO \
"\033[103m     \033[103m \033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m     \033[48;5;16m \033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m    \033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m   \033[48;5;16m \033[48;5;16m \033[103m \033[103m \033[48;5;16m \033[48;5;16m \033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m  \033[48;5;16m \033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m  \033[48;5;16m \033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m  \033[48;5;16m \033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m  \033[48;5;16m \033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m  \033[48;5;16m \033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m  \033[48;5;16m \033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[48;5;16m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m  \033[103m \033[103m \033[103m \033[103m \033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"\
"\033[103m  \033[103m \033[103m \033[103m \033[103m \033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\033[103m \033[0m\n"
#define BACK "\033[12A"
#define PADDING "\033[27C"

FILE *popen(const char *command, const char *type);
excom(stream, com, desc)
  FILE* stream;
  char* com, desc; {
  char buf[1024];
  FILE* f = popen(com, "r");
  if (!f) {
    printf("\033[H\033[2J\033[1;91mFailed to execute command `%s`\n", desc);
    return 0;
  }
  buf[fread(buf, 1, 1024, f)]=0; /* read at most 1,024 bytes */
  fputs(buf, stream);
  return 0;
}

main(argc, argv)
  int argc;
  char** argv; {
  printf(LOGO BACK);
  printf(PADDING BOLD "OS: " RESET);
  excom(stdout, "echo $(lsb_release -a | grep Description | cut -b 14-) $(uname -r) $(uname -m)", "OS");
  printf(PADDING BOLD "Hostname: " RESET);
  excom(stdout, "hostname", "Hostname");
  printf(PADDING BOLD "Uptime: " RESET);
  excom(stdout, "uptime -p | cut -b 4-", "Hostname");
  printf(PADDING BOLD "Ae programs installed:" RESET);
  excom(stdout, "for i in aefetch aesh aebar; do if [[ $(which 2>/dev/null \"$i\") ]]; then echo -ne \" $i\"; fi; done", "Ae programs installed");
  printf("\n" PADDING BOLD "Resolution: " RESET);
  excom(stdout, "xdpyinfo | awk '/dimensions/{print $2}'", "Resolution");
  printf(PADDING BOLD "Terminal: " RESET);
  excom(stdout, "echo \"$TERM\"", "Terminal");
  printf(PADDING BOLD "CPU: " RESET);
  excom(stdout, "cat /proc/cpuinfo | awk '/^model name/ { printf \"%s %s %s %s %s %s\\n\", $4, $5, $6, $7, $8, $9 }' | head -1", "CPU");
  printf(PADDING BOLD "GPU: " RESET);
  excom(stdout, "lspci -mm | awk '/VGA/ { printf \"%s %s %s %s %s %s\\n\", $5, $6, $7, $8, $9, $10 }' | sed -e \"s/\\\"//g\"", "GPU");
  printf(PADDING BOLD "Disk (/)\033[0m: ");
  excom(stdout, "df -h / | awk '/\\/dev\\// { printf \"%s/%s\\n\", $3, $2 }'", "/");
  printf(PADDING BOLD "Memory: " RESET);
  excom(stdout, "free -h | awk '/^Mem:/ { printf \"%sB/%sGiB\\n\", $3, $2+1 }'", "Memory");

  printf("\n" PADDING "\033[41m   \033[42m   \033[43m   \033[44m   \033[45m   \033[46m   \033[47m   \033[0m\n");
  printf(     PADDING "\033[101m   \033[102m   \033[103m   \033[104m   \033[105m   \033[106m   \033[107m   \033[0m\n");

  putchar(10);
}

